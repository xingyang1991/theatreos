# TheatreOS M1 é‡Œç¨‹ç¢‘å®ŒæˆæŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: 2025-12-25  
**ç‰ˆæœ¬**: M1.1 (å®Œæ•´ç‰ˆ)

---

## ä¸€ã€æ‰§è¡Œæ‘˜è¦

**é‡Œç¨‹ç¢‘ä¸€ (M1: "å¿ƒè·³")** å·²å…¨éƒ¨å®Œæˆã€‚TheatreOS ç°åœ¨æ‹¥æœ‰äº†å®Œæ•´çš„æ ¸å¿ƒéª¨æ¶ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **Theatre Kernel** - ä¸–ç•Œå†…æ ¸ï¼ˆWorldStateã€Tickã€ApplyDeltaï¼‰
- âœ… **Scheduler** - æ’ç¨‹å™¨ï¼ˆHourPlan ç”Ÿæˆã€æˆå• Feedï¼‰
- âœ… **Scene Delivery** - åœºæ¬¡æŠ•æ”¾ï¼ˆå†…å®¹å‘å¸ƒã€Ring è¿‡æ»¤ï¼‰
- âœ… **Gate System** - é—¨ç³»ç»Ÿï¼ˆæŠ•ç¥¨ã€ä¸‹æ³¨ã€ç»“ç®—ã€Explain Cardï¼‰
- âœ… **Location & Geofence** - å®šä½ä¸å›´æ ï¼ˆRing A/B/C åˆ¤æ–­ã€Token ç­¾å‘ï¼‰
- âœ… **API Gateway** - ç»Ÿä¸€æ¥å£ï¼ˆRESTful APIã€å¥åº·æ£€æŸ¥ï¼‰

ç³»ç»Ÿå·²é€šè¿‡å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå¯ä»¥æ‰§è¡Œä»"ä¸–ç•Œ Tick"åˆ°"Gate ç»“ç®—"çš„å®Œæ•´æµç¨‹ã€‚

---

## äºŒã€å·²å®ç°ç³»ç»Ÿæ¸…å•

### 2.1 Theatre Kernelï¼ˆä¸–ç•Œå†…æ ¸ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| WorldState ç®¡ç† | âœ… | æ”¯æŒ varsã€threadsã€objects ä¸‰ç±»çŠ¶æ€ |
| Tick å¼•æ“ | âœ… | æŒ‰å°æ—¶è‡ªåŠ¨æ¨è¿›ä¸–ç•Œæ—¶é—´ |
| ApplyDelta | âœ… | å¹‚ç­‰å†™å…¥ï¼Œæ”¯æŒç‰ˆæœ¬å†²çªæ£€æµ‹ |
| äº‹ä»¶æ—¥å¿— | âœ… | æ‰€æœ‰çŠ¶æ€å˜æ›´å¯å®¡è®¡ã€å¯å›æ”¾ |

### 2.2 Schedulerï¼ˆæ’ç¨‹å™¨ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| HourPlan ç”Ÿæˆ | âœ… | æ ¹æ®ä¸–ç•ŒçŠ¶æ€è‡ªåŠ¨ç”Ÿæˆæ’ç¨‹ |
| æˆå• Feed | âœ… | æ”¯æŒå¤šå°æ—¶é¢„è§ˆ |
| åŠ¨æ€è°ƒåº¦ | âœ… | æ ¹æ® tension ç­‰å˜é‡è°ƒæ•´ theatre_mode |

### 2.3 Scene Deliveryï¼ˆåœºæ¬¡æŠ•æ”¾ï¼‰

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| å†…å®¹å‘å¸ƒ | âœ… | æ”¯æŒç‰ˆæœ¬ç®¡ç† |
| Ring è¿‡æ»¤ | âœ… | æ ¹æ®ç”¨æˆ· Ring çº§åˆ«è£å‰ªå†…å®¹ |
| é™æ€å†…å®¹ç”Ÿæˆ | âœ… | M1 é˜¶æ®µä½¿ç”¨å ä½ç¬¦å†…å®¹ |

### 2.4 Gate Systemï¼ˆé—¨ç³»ç»Ÿï¼‰â­ æ–°å¢

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Gate å®ä¾‹ç®¡ç† | âœ… | æ¯ä¸ª Slot è‡ªåŠ¨åˆ›å»º Gate |
| æŠ•ç¥¨ (Vote) | âœ… | å¹‚ç­‰æäº¤ï¼Œæ”¯æŒæ›´æ–° |
| ä¸‹æ³¨ (Stake) | âœ… | æ”¯æŒ Parimutuel å½©æ± æ¨¡å¼ |
| é’±åŒ…ç³»ç»Ÿ | âœ… | ä½™é¢ç®¡ç†ã€è´¦æœ¬å®¡è®¡ |
| ç»“ç®— (Resolve) | âœ… | è‡ªåŠ¨è®¡ç®—èµ¢å®¶ã€åˆ†é…å¥–é‡‘ |
| Explain Card | âœ… | å¯è§£é‡Šçš„ç»“ç®—ç»“æœ |
| ä¸–ç•Œåæœ | âœ… | ç»“ç®—ç»“æœå†™å…¥ WorldState |

### 2.5 Location & Geofenceï¼ˆå®šä½ä¸å›´æ ï¼‰â­ æ–°å¢

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Stage ç®¡ç† | âœ… | åœ°ç†é”šç‚¹åˆ›å»ºä¸æŸ¥è¯¢ |
| Ring è¯„ä¼° | âœ… | æ ¹æ®è·ç¦»å’Œç²¾åº¦åˆ¤æ–­ A/B/C |
| Token ç­¾å‘ | âœ… | çŸ­æœŸæœ‰æ•ˆçš„ Ring å‡­è¯ |
| éšç§ä¿æŠ¤ | âœ… | åªå­˜å‚¨ geohash6ï¼Œä¸æš´éœ²ç²¾ç¡®ä½ç½® |
| é£é™©æ£€æµ‹ | âœ… | é€Ÿåº¦å¼‚å¸¸ã€æ—¶é—´æˆ³æ ¡éªŒ |
| å®‰å…¨è¦†ç›– | âœ… | ç´§æ€¥å°é” Ring A |

---

## ä¸‰ã€API ç«¯ç‚¹æ¸…å•

### 3.1 Theatre & World State

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/v1/theatres` | åˆ›å»ºå‰§åœº |
| GET | `/v1/theatres/{id}` | è·å–å‰§åœºä¿¡æ¯ |
| GET | `/v1/theatres/{id}/world` | è·å–ä¸–ç•ŒçŠ¶æ€ |
| POST | `/v1/theatres/{id}/world/delta` | åº”ç”¨çŠ¶æ€å˜æ›´ |
| GET | `/v1/theatres/{id}/events` | æŸ¥è¯¢äº‹ä»¶æ—¥å¿— |

### 3.2 Showbill & Slots

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/v1/theatres/{id}/slots/next` | è·å–æˆå• |
| GET | `/v1/slots/{slot_id}` | è·å–åœºæ¬¡è¯¦æƒ… |

### 3.3 Gate System

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| GET | `/v1/gates/{id}` | è·å–é—¨å…ä¿¡æ¯ |
| POST | `/v1/gates/{id}/vote` | æäº¤æŠ•ç¥¨ |
| POST | `/v1/gates/{id}/stake` | æäº¤ä¸‹æ³¨ |
| GET | `/v1/gates/{id}/result` | è·å–ç»“ç®—ç»“æœ |
| GET | `/v1/users/{id}/wallet` | è·å–é’±åŒ…ä½™é¢ |

### 3.4 Location & Geofence

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/v1/theatres/{id}/ring/evaluate` | è¯„ä¼° Ring çº§åˆ« |
| GET | `/v1/theatres/{id}/stages/nearby` | è·å–é™„è¿‘èˆå° |
| POST | `/v1/theatres/{id}/stages` | åˆ›å»ºèˆå° |
| POST | `/v1/ring/verify` | éªŒè¯ Ring Token |

### 3.5 Admin/Demo

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/v1/admin/theatres/{id}/tick` | æ‰‹åŠ¨è§¦å‘ Tick |
| POST | `/v1/admin/theatres/{id}/generate-plan` | ç”Ÿæˆæ’ç¨‹ |
| POST | `/v1/admin/slots/{id}/publish` | å‘å¸ƒå†…å®¹ |
| POST | `/v1/admin/theatres/{id}/demo-cycle` | è¿è¡Œæ¼”ç¤ºå‘¨æœŸ |
| POST | `/v1/admin/theatres/{id}/demo-full-cycle` | å®Œæ•´æ¼”ç¤ºï¼ˆå« Gateï¼‰ |
| POST | `/v1/admin/users/{id}/grant` | å‘æ”¾åˆå§‹ä½™é¢ |

---

## å››ã€æµ‹è¯•éªŒè¯ç»“æœ

### 4.1 å®Œæ•´æ¼”ç¤ºå‘¨æœŸæµ‹è¯•

```json
{
  "success": true,
  "theatre_id": "3d05fb78-d68e-4580-9276-45deaa6f2ba3",
  "tick": {"tick_id": 490728, "version": 1},
  "plan": {
    "slot_id": "W1_D4_0100",
    "primary_thread": "thread_01",
    "gate_type": "Public"
  },
  "gate": {
    "gate_instance_id": "b1831fe2-ca09-48ed-b390-3cb99d7fd4cd",
    "status": "RESOLVED",
    "winner_option_id": "opt_a",
    "explain_card": {
      "winner": {"label": "é€‰é¡¹Aï¼šè¿½æŸ¥çº¿ç´¢", "vote_share": 0.67},
      "narrative_impact": "é›†ä½“é€‰æ‹©äº†ã€Œé€‰é¡¹Aï¼šè¿½æŸ¥çº¿ç´¢ã€ï¼Œè¿™å°†å½±å“æ¥ä¸‹æ¥çš„å‰§æƒ…èµ°å‘ã€‚"
    }
  },
  "stages_created": ["stg_001", "stg_002", "stg_003"]
}
```

### 4.2 Ring è¯„ä¼°æµ‹è¯•

```json
{
  "theatre_id": "3d05fb78-d68e-4580-9276-45deaa6f2ba3",
  "slot_id": "W1_D4_0100",
  "rings": [
    {"stage_id": "stg_001", "ring_level": "A", "distance_m": 0.0},
    {"stage_id": "stg_002", "ring_level": "C", "distance_m": 1610.4}
  ],
  "global_risk_level": "LOW"
}
```

---

## äº”ã€ä»£ç ç»“æ„

```
/home/ubuntu/theatreos/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py              # å…¨å±€é…ç½®
â”œâ”€â”€ kernel/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ database.py          # æ•°æ®åº“æ¨¡å‹
â”‚       â””â”€â”€ kernel_service.py    # Kernel æœåŠ¡
â”œâ”€â”€ scheduler/
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ scheduler_service.py # Scheduler æœåŠ¡
â”œâ”€â”€ gateway/
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.py              # FastAPI åº”ç”¨
â”‚       â””â”€â”€ scene_delivery.py    # Scene Delivery æœåŠ¡
â”œâ”€â”€ gate/                        # â­ æ–°å¢
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ gate_service.py      # Gate æœåŠ¡
â”œâ”€â”€ location/                    # â­ æ–°å¢
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ location_service.py  # Location æœåŠ¡
â””â”€â”€ requirements.txt
```

---

## å…­ã€ä¸‹ä¸€æ­¥ï¼šM2 "å¯¼æ¼”"

M1 å·²å®Œæˆï¼Œç³»ç»Ÿå…·å¤‡äº†å®Œæ•´çš„"å¿ƒè·³"èƒ½åŠ›ã€‚ä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘ **M2: "å¯¼æ¼”"** å°†å¼•å…¥ AI å†…å®¹å·¥å‚ï¼Œå®ç°ï¼š

1. **Content Factory Orchestrator** - å†…å®¹ç”Ÿæˆç¼–æ’ï¼ˆä½¿ç”¨å·¥ä½œæµå¼•æ“ï¼‰
2. **CanonGuard Compiler** - è¿ç»­æ€§ç¼–è¯‘å™¨ï¼ˆè§„åˆ™æ£€æŸ¥ï¼‰
3. **Render Pipeline** - åª’ä½“ç”Ÿæˆï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ï¼‰

å±Šæ—¶ï¼Œç³»ç»Ÿå°†ä»"æŠ•æ”¾é™æ€å†…å®¹"å‡çº§ä¸º"è‡ªåŠ¨ç”ŸæˆåŠ¨æ€å‰§æœ¬"ã€‚

---

## ä¸ƒã€ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TheatreOS M1.1                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Kernel    â”‚â”€â”€â”€â–¶â”‚  Scheduler  â”‚â”€â”€â”€â–¶â”‚   Scene     â”‚         â”‚
â”‚  â”‚ (WorldState)â”‚    â”‚ (HourPlan)  â”‚    â”‚  Delivery   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                                      â”‚                â”‚
â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    Gate     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                   â”‚  (Vote/Stakeâ”‚                               â”‚
â”‚                   â”‚   /Resolve) â”‚                               â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                          â”‚                                      â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                   â”‚  Location   â”‚                               â”‚
â”‚                   â”‚ (Ring A/B/C)â”‚                               â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      API Gateway (FastAPI)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**M1 é‡Œç¨‹ç¢‘å·²åœ†æ»¡å®Œæˆï¼** ğŸ­
